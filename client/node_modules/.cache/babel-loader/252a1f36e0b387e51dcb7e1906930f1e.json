{"ast":null,"code":"import _defineProperty from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,useEffect}from'react';import axios from'axios';import{GlobalState}from'../../../GlobalState';import Loading from'../utils/loading/Loading';import{useHistory,useParams}from'react-router-dom';var initialState={product_id:'',title:'',price:0,description:'How to and tutorial videos of cool CSS effect, Web Design ideas,JavaScript libraries, Node.',content:'Welcome to our channel Dev AT. Here you can learn web designing, UI/UX designing, html css tutorials, css animations and css effects, javascript and jquery tutorials and related so on.',category:'',_id:''};function CreateProduct(){var state=useContext(GlobalState);var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _state$categoriesAPI$=_slicedToArray(state.categoriesAPI.categories,1),categories=_state$categoriesAPI$[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),images=_useState4[0],setImages=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var history=useHistory();var param=useParams();var _state$productsAPI$pr=_slicedToArray(state.productsAPI.products,1),products=_state$productsAPI$pr[0];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),onEdit=_useState8[0],setOnEdit=_useState8[1];var _state$productsAPI$ca=_slicedToArray(state.productsAPI.callback,2),callback=_state$productsAPI$ca[0],setCallback=_state$productsAPI$ca[1];useEffect(function(){if(param.id){setOnEdit(true);products.forEach(function(product){if(product._id===param.id){setProduct(product);setImages(product.images);}});}else{setOnEdit(false);setProduct(initialState);setImages(false);}},[param.id,products]);var handleUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;if(isAdmin){_context.next=4;break;}return _context.abrupt(\"return\",alert(\"You're not an admin\"));case 4:file=e.target.files[0];if(file){_context.next=7;break;}return _context.abrupt(\"return\",alert(\"File not exist.\"));case 7:if(!(file.size>1024*1024)){_context.next=9;break;}return _context.abrupt(\"return\",alert(\"Size too large!\"));case 9:if(!(file.type!=='image/jpeg'&&file.type!=='image/png')){_context.next=11;break;}return _context.abrupt(\"return\",alert(\"File format is incorrect.\"));case 11:formData=new FormData();formData.append('file',file);setLoading(true);_context.next=16;return axios.post('/api/upload',formData,{headers:{'content-type':'multipart/form-data',Authorization:token}});case 16:res=_context.sent;setLoading(false);setImages(res.data);_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](1);alert(_context.t0.response.data.msg);case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,21]]);}));return function handleUpload(_x){return _ref.apply(this,arguments);};}();var handleDestroy=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(isAdmin){_context2.next=3;break;}return _context2.abrupt(\"return\",alert(\"You're not an admin\"));case 3:setLoading(true);_context2.next=6;return axios.post('/api/destroy',{public_id:images.public_id},{headers:{Authorization:token}});case 6:setLoading(false);setImages(false);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);alert(_context2.t0.response.data.msg);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function handleDestroy(){return _ref2.apply(this,arguments);};}();var handleChangeInput=function handleChangeInput(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setProduct(_objectSpread(_objectSpread({},product),{},_defineProperty({},name,value)));};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;if(isAdmin){_context3.next=4;break;}return _context3.abrupt(\"return\",alert(\"You're not an admin\"));case 4:if(images){_context3.next=6;break;}return _context3.abrupt(\"return\",alert(\"No Image Upload\"));case 6:if(!onEdit){_context3.next=11;break;}_context3.next=9;return axios.put(\"/api/products/\".concat(product._id),_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 9:_context3.next=13;break;case 11:_context3.next=13;return axios.post('/api/products',_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 13:setCallback(!callback);history.push(\"/\");_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.response.data.msg);case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[1,17]]);}));return function handleSubmit(_x2){return _ref3.apply(this,arguments);};}();var styleUpload={display:images?\"block\":\"none\"};return/*#__PURE__*/React.createElement(\"div\",{className:\"create_product\"},/*#__PURE__*/React.createElement(\"div\",{className:\"upload\"},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",name:\"file\",id:\"file_up\",onChange:handleUpload}),loading?/*#__PURE__*/React.createElement(\"div\",{id:\"file_img\"},/*#__PURE__*/React.createElement(Loading,null)):/*#__PURE__*/React.createElement(\"div\",{id:\"file_img\",style:styleUpload},/*#__PURE__*/React.createElement(\"img\",{src:images?images.url:'',alt:\"\"}),/*#__PURE__*/React.createElement(\"span\",{onClick:handleDestroy},\"X\"))),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"product_id\"},\"Product ID\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"product_id\",id:\"product_id\",required:true,value:product.product_id,onChange:handleChangeInput,disabled:onEdit})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"title\"},\"Title\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"title\",id:\"title\",required:true,value:product.title,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"price\"},\"Price\"),/*#__PURE__*/React.createElement(\"input\",{type:\"number\",name:\"price\",id:\"price\",required:true,value:product.price,onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"description\"},\"Description\"),/*#__PURE__*/React.createElement(\"textarea\",{type:\"text\",name:\"description\",id:\"description\",required:true,value:product.description,rows:\"5\",onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"content\"},\"Content\"),/*#__PURE__*/React.createElement(\"textarea\",{type:\"text\",name:\"content\",id:\"content\",required:true,value:product.content,rows:\"7\",onChange:handleChangeInput})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"categories\"},\"Categories: \"),/*#__PURE__*/React.createElement(\"select\",{name:\"category\",value:product.category,onChange:handleChangeInput},/*#__PURE__*/React.createElement(\"option\",{value:\"\"},\"Please select a category\"),categories.map(function(category){return/*#__PURE__*/React.createElement(\"option\",{value:category._id,key:category._id},category.name);}))),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},onEdit?\"Update\":\"Create\")));}export default CreateProduct;","map":{"version":3,"sources":["/home/mihirpanchal/PROJECTS/book_store/client/src/components/mainpages/createProduct/CreateProduct.js"],"names":["React","useState","useContext","useEffect","axios","GlobalState","Loading","useHistory","useParams","initialState","product_id","title","price","description","content","category","_id","CreateProduct","state","product","setProduct","categoriesAPI","categories","images","setImages","loading","setLoading","userAPI","isAdmin","token","history","param","productsAPI","products","onEdit","setOnEdit","callback","setCallback","id","forEach","handleUpload","e","preventDefault","alert","file","target","files","size","type","formData","FormData","append","post","headers","Authorization","res","data","response","msg","handleDestroy","public_id","handleChangeInput","name","value","handleSubmit","put","push","styleUpload","display","url","map"],"mappings":"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","sourcesContent":["import React, {useState, useContext, useEffect} from 'react'\nimport axios from 'axios'\nimport {GlobalState} from '../../../GlobalState'\nimport Loading from '../utils/loading/Loading'\nimport {useHistory, useParams} from 'react-router-dom'\n\nconst initialState = {\n    product_id: '',\n    title: '',\n    price: 0,\n    description: 'How to and tutorial videos of cool CSS effect, Web Design ideas,JavaScript libraries, Node.',\n    content: 'Welcome to our channel Dev AT. Here you can learn web designing, UI/UX designing, html css tutorials, css animations and css effects, javascript and jquery tutorials and related so on.',\n    category: '',\n    _id: ''\n}\n\nfunction CreateProduct() {\n    const state = useContext(GlobalState)\n    const [product, setProduct] = useState(initialState)\n    const [categories] = state.categoriesAPI.categories\n    const [images, setImages] = useState(false)\n    const [loading, setLoading] = useState(false)\n\n\n    const [isAdmin] = state.userAPI.isAdmin\n    const [token] = state.token\n\n    const history = useHistory()\n    const param = useParams()\n\n    const [products] = state.productsAPI.products\n    const [onEdit, setOnEdit] = useState(false)\n    const [callback, setCallback] = state.productsAPI.callback\n\n    useEffect(() => {\n        if(param.id){\n            setOnEdit(true)\n            products.forEach(product => {\n                if(product._id === param.id) {\n                    setProduct(product)\n                    setImages(product.images)\n                }\n            })\n        }else{\n            setOnEdit(false)\n            setProduct(initialState)\n            setImages(false)\n        }\n    }, [param.id, products])\n\n    const handleUpload = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"You're not an admin\")\n            const file = e.target.files[0]\n            \n            if(!file) return alert(\"File not exist.\")\n\n            if(file.size > 1024 * 1024) // 1mb\n                return alert(\"Size too large!\")\n\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png') // 1mb\n                return alert(\"File format is incorrect.\")\n\n            let formData = new FormData()\n            formData.append('file', file)\n\n            setLoading(true)\n            const res = await axios.post('/api/upload', formData, {\n                headers: {'content-type': 'multipart/form-data', Authorization: token}\n            })\n            setLoading(false)\n            setImages(res.data)\n\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const handleDestroy = async () => {\n        try {\n            if(!isAdmin) return alert(\"You're not an admin\")\n            setLoading(true)\n            await axios.post('/api/destroy', {public_id: images.public_id}, {\n                headers: {Authorization: token}\n            })\n            setLoading(false)\n            setImages(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const handleChangeInput = e =>{\n        const {name, value} = e.target\n        setProduct({...product, [name]:value})\n    }\n\n    const handleSubmit = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"You're not an admin\")\n            if(!images) return alert(\"No Image Upload\")\n\n            if(onEdit){\n                await axios.put(`/api/products/${product._id}`, {...product, images}, {\n                    headers: {Authorization: token}\n                })\n            }else{\n                await axios.post('/api/products', {...product, images}, {\n                    headers: {Authorization: token}\n                })\n            }\n            setCallback(!callback)\n            history.push(\"/\")\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const styleUpload = {\n        display: images ? \"block\" : \"none\"\n    }\n    return (\n        <div className=\"create_product\">\n            <div className=\"upload\">\n                <input type=\"file\" name=\"file\" id=\"file_up\" onChange={handleUpload}/>\n                {\n                    loading ? <div id=\"file_img\"><Loading /></div>\n\n                    :<div id=\"file_img\" style={styleUpload}>\n                        <img src={images ? images.url : ''} alt=\"\"/>\n                        <span onClick={handleDestroy}>X</span>\n                    </div>\n                }\n                \n            </div>\n\n            <form onSubmit={handleSubmit}>\n                <div className=\"row\">\n                    <label htmlFor=\"product_id\">Product ID</label>\n                    <input type=\"text\" name=\"product_id\" id=\"product_id\" required\n                    value={product.product_id} onChange={handleChangeInput} disabled={onEdit} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"title\">Title</label>\n                    <input type=\"text\" name=\"title\" id=\"title\" required\n                    value={product.title} onChange={handleChangeInput} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"price\">Price</label>\n                    <input type=\"number\" name=\"price\" id=\"price\" required\n                    value={product.price} onChange={handleChangeInput} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"description\">Description</label>\n                    <textarea type=\"text\" name=\"description\" id=\"description\" required\n                    value={product.description} rows=\"5\" onChange={handleChangeInput} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"content\">Content</label>\n                    <textarea type=\"text\" name=\"content\" id=\"content\" required\n                    value={product.content} rows=\"7\" onChange={handleChangeInput} />\n                </div>\n\n                <div className=\"row\">\n                    <label htmlFor=\"categories\">Categories: </label>\n                    <select name=\"category\" value={product.category} onChange={handleChangeInput} >\n                        <option value=\"\">Please select a category</option>\n                        {\n                            categories.map(category => (\n                                <option value={category._id} key={category._id}>\n                                    {category.name}\n                                </option>\n                            ))\n                        }\n                    </select>\n                </div>\n\n                <button type=\"submit\">{onEdit? \"Update\" : \"Create\"}</button>\n            </form>\n        </div>\n    )\n}\n\nexport default CreateProduct\n"]},"metadata":{},"sourceType":"module"}