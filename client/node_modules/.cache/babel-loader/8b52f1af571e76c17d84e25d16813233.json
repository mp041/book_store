{"ast":null,"code":"import _objectSpread from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import axios from'axios';function UserAPI(token){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLogged=_useState2[0],setIsLogged=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAdmin=_useState4[0],setIsAdmin=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cart=_useState6[0],setCart=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),history=_useState8[0],setHistory=_useState8[1];useEffect(function(){if(token){var getUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/user/infor',{headers:{Authorization:token}});case 3:res=_context.sent;setIsLogged(true);res.data.role===1?setIsAdmin(true):setIsAdmin(false);setCart(res.data.cart);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function getUser(){return _ref.apply(this,arguments);};}();getUser();}},[token]);var addCart=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(product){var check;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(isLogged){_context2.next=2;break;}return _context2.abrupt(\"return\",alert(\"Please login to continue buying\"));case 2:check=cart.every(function(item){return item._id!==product._id;});if(!check){_context2.next=9;break;}setCart([].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})]));_context2.next=7;return axios.patch('/user/addcart',{cart:[].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})])},{headers:{Authorization:token}});case 7:_context2.next=10;break;case 9:alert(\"This product has been added to cart.\");case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function addCart(_x){return _ref2.apply(this,arguments);};}();return{isLogged:[isLogged,setIsLogged],isAdmin:[isAdmin,setIsAdmin],cart:[cart,setCart],addCart:addCart,history:[history,setHistory]};}export default UserAPI;","map":{"version":3,"sources":["/home/mihirpanchal/PROJECTS/book_store/client/src/api/UserAPI.js"],"names":["useState","useEffect","axios","UserAPI","token","isLogged","setIsLogged","isAdmin","setIsAdmin","cart","setCart","history","setHistory","getUser","get","headers","Authorization","res","data","role","alert","response","msg","addCart","product","check","every","item","_id","quantity","patch"],"mappings":"wzBAAA,OAAQA,QAAR,CAAkBC,SAAlB,KAAkC,OAAlC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,QAASC,CAAAA,OAAT,CAAiBC,KAAjB,CAAwB,eACYJ,QAAQ,CAAC,KAAD,CADpB,wCACbK,QADa,eACHC,WADG,8BAEUN,QAAQ,CAAC,KAAD,CAFlB,yCAEbO,OAFa,eAEJC,UAFI,8BAGIR,QAAQ,CAAC,EAAD,CAHZ,yCAGbS,IAHa,eAGPC,OAHO,8BAIUV,QAAQ,CAAC,EAAD,CAJlB,yCAIbW,OAJa,eAIJC,UAJI,eAMpBX,SAAS,CAAC,UAAK,CACX,GAAGG,KAAH,CAAS,CACL,GAAMS,CAAAA,OAAO,0FAAG,iLAEUX,CAAAA,KAAK,CAACY,GAAN,CAAU,aAAV,CAAyB,CACvCC,OAAO,CAAE,CAACC,aAAa,CAAEZ,KAAhB,CAD8B,CAAzB,CAFV,QAEFa,GAFE,eAMRX,WAAW,CAAC,IAAD,CAAX,CACAW,GAAG,CAACC,IAAJ,CAASC,IAAT,GAAkB,CAAlB,CAAsBX,UAAU,CAAC,IAAD,CAAhC,CAAyCA,UAAU,CAAC,KAAD,CAAnD,CAEAE,OAAO,CAACO,GAAG,CAACC,IAAJ,CAAST,IAAV,CAAP,CATQ,+EAYRW,KAAK,CAAC,YAAIC,QAAJ,CAAaH,IAAb,CAAkBI,GAAnB,CAAL,CAZQ,oEAAH,kBAAPT,CAAAA,OAAO,0CAAb,CAgBAA,OAAO,GAEV,CACJ,CArBQ,CAqBP,CAACT,KAAD,CArBO,CAAT,CAyBA,GAAMmB,CAAAA,OAAO,2FAAG,kBAAOC,OAAP,mIACRnB,QADQ,2DACSe,KAAK,CAAC,iCAAD,CADd,SAGNK,KAHM,CAGEhB,IAAI,CAACiB,KAAL,CAAW,SAAAC,IAAI,CAAG,CAC5B,MAAOA,CAAAA,IAAI,CAACC,GAAL,GAAaJ,OAAO,CAACI,GAA5B,CACH,CAFa,CAHF,KAOTH,KAPS,0BAQRf,OAAO,8BAAKD,IAAL,kCAAee,OAAf,MAAwBK,QAAQ,CAAE,CAAlC,KAAP,CARQ,uBAUF3B,CAAAA,KAAK,CAAC4B,KAAN,CAAY,eAAZ,CAA6B,CAACrB,IAAI,8BAAMA,IAAN,kCAAgBe,OAAhB,MAAyBK,QAAQ,CAAE,CAAnC,IAAL,CAA7B,CAA2E,CAC7Ed,OAAO,CAAE,CAACC,aAAa,CAAEZ,KAAhB,CADoE,CAA3E,CAVE,uCAeRgB,KAAK,CAAC,sCAAD,CAAL,CAfQ,yDAAH,kBAAPG,CAAAA,OAAO,6CAAb,CAmBA,MAAO,CACHlB,QAAQ,CAAE,CAACA,QAAD,CAAWC,WAAX,CADP,CAEHC,OAAO,CAAE,CAACA,OAAD,CAAUC,UAAV,CAFN,CAGHC,IAAI,CAAE,CAACA,IAAD,CAAOC,OAAP,CAHH,CAIHa,OAAO,CAAEA,OAJN,CAKHZ,OAAO,CAAE,CAACA,OAAD,CAAUC,UAAV,CALN,CAAP,CAOH,CAED,cAAeT,CAAAA,OAAf","sourcesContent":["import {useState, useEffect} from 'react'\nimport axios from 'axios'\n\nfunction UserAPI(token) {\n    const [isLogged, setIsLogged] = useState(false)\n    const [isAdmin, setIsAdmin] = useState(false)\n    const [cart, setCart] = useState([])\n    const [history, setHistory] = useState([])\n\n    useEffect(() =>{\n        if(token){\n            const getUser = async () =>{\n                try {\n                    const res = await axios.get('/user/infor', {\n                        headers: {Authorization: token}\n                    })\n\n                    setIsLogged(true)\n                    res.data.role === 1 ? setIsAdmin(true) : setIsAdmin(false)\n\n                    setCart(res.data.cart)\n\n                } catch (err) {\n                    alert(err.response.data.msg)\n                }\n            }\n\n            getUser()\n\n        }\n    },[token])\n\n\n\n    const addCart = async (product) => {\n        if(!isLogged) return alert(\"Please login to continue buying\")\n\n        const check = cart.every(item =>{\n            return item._id !== product._id\n        })\n\n        if(check){\n            setCart([...cart, {...product, quantity: 1}])\n\n            await axios.patch('/user/addcart', {cart: [...cart, {...product, quantity: 1}]}, {\n                headers: {Authorization: token}\n            })\n\n        }else{\n            alert(\"This product has been added to cart.\")\n        }\n    }\n\n    return {\n        isLogged: [isLogged, setIsLogged],\n        isAdmin: [isAdmin, setIsAdmin],\n        cart: [cart, setCart],\n        addCart: addCart,\n        history: [history, setHistory]\n    }\n}\n\nexport default UserAPI\n \n"]},"metadata":{},"sourceType":"module"}