{"ast":null,"code":"import _regeneratorRuntime from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/mihirpanchal/PROJECTS/book_store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from'react';import{GlobalState}from'../../../GlobalState';import ProductItem from'../utils/productItem/ProductItem';import Loading from'../utils/loading/Loading';import axios from'axios';import Filters from'./Filters';import LoadMore from'./LoadMore';function Products(){var state=useContext(GlobalState);var _state$productsAPI$pr=_slicedToArray(state.productsAPI.products,2),products=_state$productsAPI$pr[0],setProducts=_state$productsAPI$pr[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var _state$productsAPI$ca=_slicedToArray(state.productsAPI.callback,2),callback=_state$productsAPI$ca[0],setCallback=_state$productsAPI$ca[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isCheck=_useState4[0],setIsCheck=_useState4[1];var handleCheck=function handleCheck(id){products.forEach(function(product){if(product._id===id)product.checked=!product.checked;});setProducts(_toConsumableArray(products));};var deleteProduct=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id,public_id){var destroyImg,_deleteProduct;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);destroyImg=axios.post('/api/destroy',{public_id:public_id},{headers:{Authorization:token}});_deleteProduct=axios.delete(\"/api/products/\".concat(id),{headers:{Authorization:token}});_context.next=6;return destroyImg;case 6:_context.next=8;return _deleteProduct;case 8:setCallback(!callback);setLoading(false);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function deleteProduct(_x,_x2){return _ref.apply(this,arguments);};}();var checkAll=function checkAll(){products.forEach(function(product){product.checked=!isCheck;});setProducts(_toConsumableArray(products));setIsCheck(!isCheck);};var deleteAll=function deleteAll(){products.forEach(function(product){if(product.checked)deleteProduct(product._id,product.images.public_id);});};if(loading)return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Loading,null));return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Filters,null),isAdmin&&/*#__PURE__*/React.createElement(\"div\",{className:\"delete-all\"},/*#__PURE__*/React.createElement(\"span\",null,\"Select all\"),/*#__PURE__*/React.createElement(\"input\",{type:\"checkbox\",checked:isCheck,onChange:checkAll}),/*#__PURE__*/React.createElement(\"button\",{onClick:deleteAll},\"Delete ALL\")),/*#__PURE__*/React.createElement(\"div\",{className:\"products\"},products.map(function(product){return/*#__PURE__*/React.createElement(ProductItem,{key:product._id,product:product,isAdmin:isAdmin,deleteProduct:deleteProduct,handleCheck:handleCheck});})),/*#__PURE__*/React.createElement(LoadMore,null),products.length===0&&/*#__PURE__*/React.createElement(Loading,null));}export default Products;","map":{"version":3,"sources":["/home/mihirpanchal/PROJECTS/book_store/client/src/components/mainpages/products/Products.js"],"names":["React","useContext","useState","GlobalState","ProductItem","Loading","axios","Filters","LoadMore","Products","state","productsAPI","products","setProducts","userAPI","isAdmin","token","callback","setCallback","loading","setLoading","isCheck","setIsCheck","handleCheck","id","forEach","product","_id","checked","deleteProduct","public_id","destroyImg","post","headers","Authorization","delete","alert","response","data","msg","checkAll","deleteAll","images","map","length"],"mappings":"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","sourcesContent":["import React, {useContext, useState} from 'react'\nimport {GlobalState} from '../../../GlobalState'\nimport ProductItem from '../utils/productItem/ProductItem'\nimport Loading from '../utils/loading/Loading'\nimport axios from 'axios'\nimport Filters from './Filters'\nimport LoadMore from './LoadMore'\n\n\nfunction Products() {\n    const state = useContext(GlobalState)\n    const [products, setProducts] = state.productsAPI.products\n    const [isAdmin] = state.userAPI.isAdmin\n    const [token] = state.token\n    const [callback, setCallback] = state.productsAPI.callback\n    const [loading, setLoading] = useState(false)\n    const [isCheck, setIsCheck] = useState(false)\n\n    const handleCheck = (id) =>{\n        products.forEach(product => {\n            if(product._id === id) product.checked = !product.checked\n        })\n        setProducts([...products])\n    }\n\n    const deleteProduct = async(id, public_id) => {\n        try {\n            setLoading(true)\n            const destroyImg = axios.post('/api/destroy', {public_id},{\n                headers: {Authorization: token}\n            })\n            const deleteProduct = axios.delete(`/api/products/${id}`, {\n                headers: {Authorization: token}\n            })\n\n            await destroyImg\n            await deleteProduct\n            setCallback(!callback)\n            setLoading(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n    const checkAll = () =>{\n        products.forEach(product => {\n            product.checked = !isCheck\n        })\n        setProducts([...products])\n        setIsCheck(!isCheck)\n    }\n\n    const deleteAll = () =>{\n        products.forEach(product => {\n            if(product.checked) deleteProduct(product._id, product.images.public_id)\n        })\n    }\n\n    if(loading) return <div><Loading /></div>\n    return (\n        <>\n        <Filters />\n        \n        {\n            isAdmin && \n            <div className=\"delete-all\">\n                <span>Select all</span>\n                <input type=\"checkbox\" checked={isCheck} onChange={checkAll} />\n                <button onClick={deleteAll}>Delete ALL</button>\n            </div>\n        }\n\n        <div className=\"products\">\n            {\n                products.map(product => {\n                    return <ProductItem key={product._id} product={product}\n                    isAdmin={isAdmin} deleteProduct={deleteProduct} handleCheck={handleCheck} />\n                })\n            } \n        </div>\n\n        <LoadMore />\n        {products.length === 0 && <Loading />}\n        </>\n    )\n}\n\nexport default Products\n"]},"metadata":{},"sourceType":"module"}